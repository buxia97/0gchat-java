(window.webpackJsonp=window.webpackJsonp||[]).push([[3,6],{712:function(t,e,n){"use strict";n.r(e);n(49),n(39),n(48),n(15),n(79),n(32),n(80);var r=n(30),o=(n(59),n(25),n(58),n(81));function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var c={props:{msgList:{type:Array,default:function(){return[]}}},data:function(){return{userKey:null}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(o.b)({userInfo:function(t){return t.userInfo},token:function(t){return t.token}})),watch:{userInfo:function(t,e){var n=this;null!=n.userInfo&&(n.userKey=n.userInfo.userKey)}},mounted:function(){var t=this;null!=t.userInfo&&(t.userKey=t.userInfo.userKey)},methods:{formatDate:function(t){return(t=new Date(parseInt(1e3*t))).getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2)+" "+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)},replaceNewlinesWithBr:function(text){return text.replace(/\n/g,"<br>")},banIp:function(t){var e=this,n=this;n.$confirm("确认要封禁"+t.ip+"吗？","操作提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var data={ip:t.ip,chatid:t.chatid,token:n.token},r=e.$loading({lock:!0,spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});n.$axios.$post(n.$api.banUser(),e.qs.stringify(data),{progress:!1}).then((function(t){r.close(),1==t.code?n.$message({message:"操作成功！",type:"success"}):n.$message({message:t.msg,type:"error"})})).catch((function(t){r.close(),console.log(t),n.$message({message:"接口请求异常，请检查网络！",type:"error"})}))})).catch((function(){}))},deleteMsg:function(t){var e=this,n=this;n.$confirm("确认要删除该消息吗？","操作提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var data={key:t,token:n.token},r=e.$loading({lock:!0,spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});n.$axios.$post(n.$api.msgDelete(),e.qs.stringify(data),{progress:!1}).then((function(t){r.close(),1==t.code?n.$message({message:"操作成功！",type:"success"}):n.$message({message:t.msg,type:"error"})})).catch((function(t){r.close(),console.log(t),n.$message({message:"接口请求异常，请检查网络！",type:"error"})}))})).catch((function(){}))},reply:function(t){this.$parent.replyJson=t}}},m=c,f=n(57),component=Object(f.a)(m,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"msg"},[e("el-scrollbar",{ref:"msgScroll",staticStyle:{height:"100%"}},t._l(t.msgList,(function(n,r){return e("div",{staticClass:"msg-box",class:t.userKey==n.userKey?"my":""},[2!=n.type?[e("div",{staticClass:"msg-main"},[e("div",{staticClass:"msg-avatar"},[e("el-image",{attrs:{src:"/avatar/"+n.avatar+".webp"}})],1),t._v(" "),e("div",{staticClass:"msg-concent"},[e("div",{staticClass:"msg-concent-value"},[e("span",{staticClass:"mag-userName"},[t._v(t._s(n.userName))]),t._v(" "),e("span",{staticClass:"mag-postTime"},[t._v(t._s(t.formatDate(n.created)))]),t._v(" "),e("span",{staticClass:"reply",on:{click:function(e){return t.reply(n)}}},[t._v("回复")])]),t._v(" "),e("div",{staticClass:"msg-concent-text"},[0==n.type?[e("div",{staticClass:"msg-text",domProps:{innerHTML:t._s(t.replaceNewlinesWithBr(n.text))}})]:t._e(),t._v(" "),3==n.type?[e("div",{staticClass:"msg-text"},[e("a",{attrs:{href:n.url}},[e("i",{staticClass:"el-icon-link"}),t._v(t._s(n.text))])])]:t._e(),t._v(" "),n.replyJSon&&0==n.type?e("div",{staticClass:"msg-reply"},[e("div",{staticClass:"reply-text"},[1==n.replyJSon.isDeleted?[t._v("\n                  消息已删除\n                ")]:[0==n.replyJSon.type?[t._v("\n                    "+t._s(n.replyJSon.text)+"\n                  ")]:t._e(),t._v(" "),3==n.replyJSon.type?[e("a",{attrs:{href:n.url}},[e("i",{staticClass:"el-icon-link"}),t._v(t._s(n.text))])]:t._e()]],2)]):t._e(),t._v(" "),""!=t.token?e("div",{staticClass:"msg-system-btn"},[e("span",{on:{click:function(e){return t.banIp(n)}}},[t._v("封禁")]),t._v(" "),e("span",{on:{click:function(e){return t.deleteMsg(n.id)}}},[t._v("删除")])]):t._e()],2)])])]:t._e(),t._v(" "),2==n.type?[e("div",{staticClass:"msg-system"},[e("div",{staticClass:"msg-system-text"},[t._v("\n        "+t._s(n.userName)+" : "+t._s(n.text)+"\n        ")])])]:t._e()],2)})),0)],1)}),[],!1,null,null,null);e.default=component.exports},717:function(t,e,n){"use strict";n.r(e);n(47),n(39),n(48),n(15),n(79),n(32),n(80);var r=n(30),o=(n(299),n(102),n(49),n(101),n(81));function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var c={props:{chatInfo:{type:Object},chatId:{type:Number,default:0}},data:function(){return{msg:"",msgList:null,lastTime:0,msgInterval:null,linksVisible:!1,Loadlock:0,linkForm:{name:"",url:""},isShow:!1,isSysMsg:0,replyJson:null}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(o.b)({userInfo:function(t){return t.userInfo},curChat:function(t){return t.curChat}})),watch:{curChat:function(t,e){var n=this;n.isSysMsg=0,n.msgList=null,n.lastTime=0,n.loadMsg(!1),clearInterval(n.msgInterval),n.msgInterval=null,n.msgInterval=setInterval((function(){0!=n.chatId&&n.loadMsg(!0)}),3e3)}},beforeDestroy:function(){clearInterval(this.msgInterval),this.msgInterval=null},mounted:function(){var t=this;t.loadMsg(!1),t.$once("hook:beforeDestroy",(function(){clearInterval(t.msgInterval),t.msgInterval=null})),clearInterval(t.msgInterval),t.msgInterval=null,t.msgInterval=setInterval((function(){if(null==t.userInfo)return!1;0!=t.chatId?t.loadMsg(!0):(clearInterval(t.msgInterval),t.msgInterval=null)}),3e3)},methods:{chatBack:function(){this.$store.commit("setCurChat",0)},loadMsg:function(t){var e=this;if(!t)try{if(localStorage.getItem("0gsf_msgList_"+e.chatId)){var n=JSON.parse(localStorage.getItem("0gsf_msgList_"+e.chatId));e.lastTime=n[n.length-1].created,e.msgList=n,n.length>0&&setTimeout((function(){e.$nextTick((function(){e.$refs.msg.$refs.msgScroll.wrap.scrollTop=e.$refs.msg.$refs.msgScroll.wrap.scrollHeight}))}),100)}}catch(t){console.log(t),e.lastTime=0,e.msgList=[]}0==e.lastTime?e.getMsgList():e.getLastMsgs()},sendLink:function(){var t=this;if(""==t.linkForm.name||""==t.linkForm.url)return!1;var e=t.userInfo;e.chatid=t.chatId,e.text=t.linkForm.name,e.url=t.linkForm.url,e.type=3;var data={params:JSON.stringify(t.$api.removeObjectEmptyKey(e))};t.linkForm={name:"",url:""},t.linksVisible=!1,t.$axios.$post(t.$api.sendMsg(),this.qs.stringify(data),{progress:!1}).then((function(e){1==e.code?(t.getLastMsgs(),setTimeout((function(){t.$nextTick((function(){t.$refs.msg.$refs.msgScroll.wrap.scrollTop=t.$refs.msg.$refs.msgScroll.wrap.scrollHeight}))}),100)):t.$message({message:e.msg,type:"error"})})).catch((function(e){console.log(e),t.$message({message:"接口请求异常，请检查网络！",type:"error"})}))},sendMsg:function(){var t=this;if(""==t.msg)return!1;if(0==t.chatId)return t.$message({message:"请选择聊天室",type:"error"}),!1;var e=t.userInfo;e.chatid=t.chatId,e.text=t.msg,e.type=0,null!=t.replyJson&&(e.reply=t.replyJson.id);var data={params:JSON.stringify(t.$api.removeObjectEmptyKey(e))};t.msg="",t.replyJson=null,t.$axios.$post(t.$api.sendMsg(),this.qs.stringify(data),{progress:!1}).then((function(e){1==e.code?(t.getLastMsgs(),setTimeout((function(){t.$nextTick((function(){t.$refs.msg.$refs.msgScroll.wrap.scrollTop=t.$refs.msg.$refs.msgScroll.wrap.scrollHeight}))}),100)):t.$message({message:e.msg,type:"error"})})).catch((function(e){console.log(e),t.$message({message:"接口请求异常，请检查网络！",type:"error"})}))},getMsgList:function(){var t=this;if(1==t.Loadlock)return!1;t.Loadlock=1;var e={chatid:t.chatId},data={searchParams:JSON.stringify(t.$api.removeObjectEmptyKey(e)),limit:800};t.$axios.$post(t.$api.msgList(),this.qs.stringify(data),{progress:!1}).then((function(e){if(t.Loadlock=0,1==e.code){var n=e.data;n.length>0?(t.lastTime=n[0].created,t.msgList=n.reverse(),setTimeout((function(){t.$nextTick((function(){t.$refs.msg.$refs.msgScroll.wrap.scrollTop=t.$refs.msg.$refs.msgScroll.wrap.scrollHeight}))}),100)):t.msgList=[];var r=t.msgList;localStorage.setItem("0gsf_msgList_"+t.chatId,JSON.stringify(r))}})).catch((function(e){t.Loadlock=0,console.log(e),t.$message({message:"接口请求异常，请检查网络！",type:"error"})}))},getLastMsgs:function(){var t=this;if(1==t.Loadlock)return!1;t.Loadlock=1;var data={chatid:t.chatId,time:t.lastTime};t.$axios.$post(t.$api.lastMsgs(),this.qs.stringify(data),{progress:!1}).then((function(e){if(t.Loadlock=0,1==e.code){var n=e.data;if(n.length>0){if(0==t.isSysMsg)if(2==n[0].type)return t.isSysMsg=1,t.getMsgList(),!1;t.lastTime!=n[0].created&&(t.lastTime=n[0].created,setTimeout((function(){t.$nextTick((function(){t.$refs.msg.$refs.msgScroll.wrap.scrollTop=t.$refs.msg.$refs.msgScroll.wrap.scrollHeight}))}),100));var r=n.reverse();t.msgList=t.msgList.concat(r)}var o=t.msgList;localStorage.setItem("0gsf_msgList_"+t.chatId,JSON.stringify(o))}})).catch((function(e){t.Loadlock=0,console.log(e),t.$message({message:"接口请求异常，请检查网络！",type:"error"})}))}}},m=c,f=n(57),component=Object(f.a)(m,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"chat"},[null!=t.chatInfo?e("div",{staticClass:"chat-wap-header"},[e("i",{staticClass:"el-icon-arrow-left",on:{click:function(e){return t.chatBack()}}}),t._v(" "),e("div",{staticClass:"chat-wap-title"},[t._v(t._s(t.chatInfo.name))]),t._v(" "),e("div",{staticClass:"chat-wap-chat-avatar",on:{click:function(e){t.isShow=!t.isShow}}},[e("el-image",{attrs:{src:"/chatAvatar/"+t.chatInfo.pic+".jpg"}}),t._v(" "),e("i",{staticClass:"el-icon-caret-bottom"})],1)]):t._e(),t._v(" "),null!=t.chatInfo?e("div",{staticClass:"chat-header",class:t.isShow?"show":""},[e("div",{staticClass:"chat-avatar"},[e("el-image",{attrs:{src:"/chatAvatar/"+t.chatInfo.pic+".jpg"}})],1),t._v(" "),e("div",{staticClass:"chat-info"},[e("div",{staticClass:"chat-info-name"},[t._v("\n        "+t._s(t.chatInfo.name)),e("span",[t._v("热度"+t._s(t.chatInfo.totalMsg))]),t._v(" "),1==t.chatInfo.status?[e("span",{staticClass:"open"},[t._v("进行中")])]:t._e(),t._v(" "),0==t.chatInfo.status?[e("span",{staticClass:"close"},[t._v("已关闭")])]:t._e()],2),t._v(" "),e("div",{staticClass:"chat-intro",domProps:{innerHTML:t._s(t.chatInfo.intro)}})])]):t._e(),t._v(" "),e("div",{staticClass:"chat-msg"},[null==t.msgList?[t._m(0)]:[e("msg",{ref:"msg",attrs:{msgList:t.msgList}})]],2),t._v(" "),null!=t.replyJson?e("div",{staticClass:"reply-main"},[e("div",{staticClass:"reply-main-text"},[t._v("\n      "+t._s(t.replyJson.userName)+" : "+t._s(t.replyJson.text)+"\n    ")]),t._v(" "),e("div",{staticClass:"reply-main-close",on:{click:function(e){t.replyJson=null}}},[e("i",{staticClass:"el-icon-close"})])]):t._e(),t._v(" "),e("div",{staticClass:"chat-input"},[0==t.chatInfo.status?[e("div",{staticClass:"chat-input-close"},[t._v("\n        频道已关闭\n      ")])]:[e("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入消息内容"},model:{value:t.msg,callback:function(e){t.msg=e},expression:"msg"}}),t._v(" "),e("div",{staticClass:"chat-btn"},[e("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-paperclip"},on:{click:function(e){t.linksVisible=!0}}}),t._v(" "),e("el-button",{attrs:{type:"primary",icon:"el-icon-position",size:"small"},on:{click:function(e){return t.sendMsg()}}},[t._v("发送")])],1)]],2),t._v(" "),e("el-dialog",{attrs:{title:"发送链接",visible:t.linksVisible,modal:!1,width:"330px"},on:{"update:visible":function(e){t.linksVisible=e}}},[e("div",{staticClass:"dialog-form"},[e("el-form",{ref:"form",attrs:{"label-position":"top"}},[e("el-form-item",{attrs:{label:"链接名称"}},[e("el-input",{attrs:{type:"text",placeholder:"请输入链接名称"},model:{value:t.linkForm.name,callback:function(e){t.$set(t.linkForm,"name",e)},expression:"linkForm.name"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"链接地址"}},[e("el-input",{attrs:{type:"text",placeholder:"请输入链接地址(http://)"},model:{value:t.linkForm.url,callback:function(e){t.$set(t.linkForm,"url",e)},expression:"linkForm.url"}})],1)],1)],1),t._v(" "),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"success",size:"medium"},on:{click:function(e){return t.sendLink()}}},[t._v("确认发送")])],1)])],1)}),[function(){var t=this._self._c;return t("div",{staticClass:"chat-msg-loading"},[t("div",{staticClass:"chat-msg-loading-main"},[t("i",{staticClass:"el-icon-loading"})])])}],!1,null,null,null);e.default=component.exports;installComponents(component,{Msg:n(712).default})}}]);