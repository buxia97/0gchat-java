(window.webpackJsonp=window.webpackJsonp||[]).push([[3,6],{712:function(t,e,r){"use strict";r.r(e);r(49),r(39),r(48),r(15),r(79),r(32),r(80);var n=r(30),o=(r(59),r(25),r(58),r(81));function c(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}var l={props:{msgList:{type:Array,default:function(){return[]}}},data:function(){return{userKey:null}},computed:function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?c(Object(r),!0).forEach((function(e){Object(n.a)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},Object(o.b)({userInfo:function(t){return t.userInfo},token:function(t){return t.token}})),watch:{userInfo:function(t,e){var r=this;null!=r.userInfo&&(r.userKey=r.userInfo.userKey)}},mounted:function(){var t=this;null!=t.userInfo&&(t.userKey=t.userInfo.userKey)},methods:{formatDate:function(t){return(t=new Date(parseInt(1e3*t))).getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2)+" "+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)},replaceNewlinesWithBr:function(text){return text.replace(/\n/g,"<br>")},banIp:function(t){var e=this,r=this;r.$confirm("确认要封禁"+t.ip+"吗？","操作提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var data={ip:t.ip,chatid:t.chatid,token:r.token},n=e.$loading({lock:!0,spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});r.$axios.$post(r.$api.banUser(),e.qs.stringify(data),{progress:!1}).then((function(t){n.close(),1==t.code?r.$message({message:"操作成功！",type:"success"}):r.$message({message:t.msg,type:"error"})})).catch((function(t){n.close(),console.log(t),r.$message({message:"接口请求异常，请检查网络！",type:"error"})}))})).catch((function(){}))},deleteMsg:function(t){}}},m=l,f=r(57),component=Object(f.a)(m,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"msg"},[e("el-scrollbar",{ref:"msgScroll",staticStyle:{height:"100%"}},t._l(t.msgList,(function(r,n){return e("div",{staticClass:"msg-box",class:t.userKey==r.userKey?"my":""},[2!=r.type?[e("div",{staticClass:"msg-main"},[e("div",{staticClass:"msg-avatar"},[e("el-image",{attrs:{src:"/avatar/"+r.avatar+".webp"}})],1),t._v(" "),e("div",{staticClass:"msg-concent"},[e("div",{staticClass:"msg-concent-value"},[e("span",{staticClass:"mag-userName"},[t._v(t._s(r.userName))]),t._v(" "),e("span",{staticClass:"mag-postTime"},[t._v(t._s(t.formatDate(r.created)))])]),t._v(" "),e("div",{staticClass:"msg-concent-text"},[0==r.type?[e("div",{staticClass:"msg-text",domProps:{innerHTML:t._s(t.replaceNewlinesWithBr(r.text))}})]:t._e(),t._v(" "),3==r.type?[e("div",{staticClass:"msg-text"},[e("a",{attrs:{href:r.url}},[e("i",{staticClass:"el-icon-link"}),t._v(t._s(r.text))])])]:t._e(),t._v(" "),""!=t.token?e("div",{staticClass:"msg-system-btn"},[e("span",{on:{click:function(e){return t.banIp(r)}}},[t._v("封禁")]),t._v(" "),e("span",{on:{click:function(e){return t.deleteMsg(r.id)}}},[t._v("删除")])]):t._e()],2)])])]:t._e(),t._v(" "),2==r.type?[e("div",{staticClass:"msg-system"},[e("div",{staticClass:"msg-system-text"},[t._v("\n        "+t._s(r.userName)+" : "+t._s(r.text)+"\n        ")])])]:t._e()],2)})),0)],1)}),[],!1,null,null,null);e.default=component.exports},717:function(t,e,r){"use strict";r.r(e);r(47),r(39),r(48),r(15),r(79),r(32),r(80);var n=r(30),o=(r(299),r(102),r(49),r(101),r(81));function c(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}var l={props:{chatInfo:{type:Object},chatId:{type:Number,default:0}},data:function(){return{msg:"",msgList:null,lastTime:0,msgInterval:null,linksVisible:!1,linkForm:{name:"",url:""},isShow:!1,isSysMsg:0}},computed:function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?c(Object(r),!0).forEach((function(e){Object(n.a)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},Object(o.b)({userInfo:function(t){return t.userInfo},curChat:function(t){return t.curChat}})),watch:{curChat:function(t,e){var r=this;r.isSysMsg=0,r.msgList=null,r.lastTime=0,r.loadMsg(!1),clearInterval(r.msgInterval),r.msgInterval=null,r.msgInterval=setInterval((function(){0!=r.chatId&&r.loadMsg(!0)}),3e3)}},beforeDestroy:function(){clearInterval(this.msgInterval),this.msgInterval=null},mounted:function(){var t=this;t.loadMsg(!1),t.$once("hook:beforeDestroy",(function(){clearInterval(t.msgInterval),t.msgInterval=null})),clearInterval(t.msgInterval),t.msgInterval=null,t.msgInterval=setInterval((function(){if(null==t.userInfo)return!1;0!=t.chatId?t.loadMsg(!0):(clearInterval(t.msgInterval),t.msgInterval=null)}),3e3)},methods:{chatBack:function(){this.$store.commit("setCurChat",0)},loadMsg:function(t){var e=this;if(!t)try{if(localStorage.getItem("0gsf_msgList_"+e.chatId)){var r=JSON.parse(localStorage.getItem("0gsf_msgList_"+e.chatId));e.lastTime=r[r.length-1].created,e.msgList=r,r.length>0&&setTimeout((function(){e.$nextTick((function(){e.$refs.msg.$refs.msgScroll.wrap.scrollTop=e.$refs.msg.$refs.msgScroll.wrap.scrollHeight}))}),100)}}catch(t){console.log(t),e.lastTime=0,e.msgList=[]}0==e.lastTime?e.getMsgList():e.getLastMsgs()},sendLink:function(){var t=this;if(""==t.linkForm.name||""==t.linkForm.url)return!1;var e=t.userInfo;e.chatid=t.chatId,e.text=t.linkForm.name,e.url=t.linkForm.url,e.type=3;var data={params:JSON.stringify(t.$api.removeObjectEmptyKey(e))};t.linkForm={name:"",url:""},t.linksVisible=!1,t.$axios.$post(t.$api.sendMsg(),this.qs.stringify(data),{progress:!1}).then((function(e){1==e.code?(t.getLastMsgs(),setTimeout((function(){t.$nextTick((function(){t.$refs.msg.$refs.msgScroll.wrap.scrollTop=t.$refs.msg.$refs.msgScroll.wrap.scrollHeight}))}),100)):t.$message({message:e.msg,type:"error"})})).catch((function(e){console.log(e),t.$message({message:"接口请求异常，请检查网络！",type:"error"})}))},sendMsg:function(){var t=this;if(""==t.msg)return!1;if(0==t.chatId)return t.$message({message:"请选择聊天室",type:"error"}),!1;var e=t.userInfo;e.chatid=t.chatId,e.text=t.msg,e.type=0;var data={params:JSON.stringify(t.$api.removeObjectEmptyKey(e))};t.msg="",t.$axios.$post(t.$api.sendMsg(),this.qs.stringify(data),{progress:!1}).then((function(e){1==e.code?(t.getLastMsgs(),setTimeout((function(){t.$nextTick((function(){t.$refs.msg.$refs.msgScroll.wrap.scrollTop=t.$refs.msg.$refs.msgScroll.wrap.scrollHeight}))}),100)):t.$message({message:e.msg,type:"error"})})).catch((function(e){console.log(e),t.$message({message:"接口请求异常，请检查网络！",type:"error"})}))},getMsgList:function(){var t=this,e={chatid:t.chatId},data={searchParams:JSON.stringify(t.$api.removeObjectEmptyKey(e)),limit:800};t.$axios.$post(t.$api.msgList(),this.qs.stringify(data),{progress:!1}).then((function(e){if(1==e.code){var r=e.data;r.length>0?(t.lastTime=r[0].created,t.msgList=r.reverse(),setTimeout((function(){t.$nextTick((function(){t.$refs.msg.$refs.msgScroll.wrap.scrollTop=t.$refs.msg.$refs.msgScroll.wrap.scrollHeight}))}),100)):t.msgList=[];var n=t.msgList;localStorage.setItem("0gsf_msgList_"+t.chatId,JSON.stringify(n))}})).catch((function(e){console.log(e),t.$message({message:"接口请求异常，请检查网络！",type:"error"})}))},getLastMsgs:function(){var t=this,data={chatid:t.chatId,time:t.lastTime};t.$axios.$post(t.$api.lastMsgs(),this.qs.stringify(data),{progress:!1}).then((function(e){if(1==e.code){var r=e.data;if(r.length>0){if(0==t.isSysMsg)if(2==r[0].type)return t.isSysMsg=1,t.getMsgList(),!1;t.lastTime!=r[0].created&&(t.lastTime=r[0].created,setTimeout((function(){t.$nextTick((function(){t.$refs.msg.$refs.msgScroll.wrap.scrollTop=t.$refs.msg.$refs.msgScroll.wrap.scrollHeight}))}),100));var n=r.reverse();t.msgList=t.msgList.concat(n)}var o=t.msgList;localStorage.setItem("0gsf_msgList_"+t.chatId,JSON.stringify(o))}})).catch((function(e){console.log(e),t.$message({message:"接口请求异常，请检查网络！",type:"error"})}))}}},m=l,f=r(57),component=Object(f.a)(m,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"chat"},[null!=t.chatInfo?e("div",{staticClass:"chat-wap-header"},[e("i",{staticClass:"el-icon-arrow-left",on:{click:function(e){return t.chatBack()}}}),t._v(" "),e("div",{staticClass:"chat-wap-title"},[t._v(t._s(t.chatInfo.name))]),t._v(" "),e("div",{staticClass:"chat-wap-chat-avatar",on:{click:function(e){t.isShow=!t.isShow}}},[e("el-image",{attrs:{src:"/chatAvatar/"+t.chatInfo.pic+".jpg"}}),t._v(" "),e("i",{staticClass:"el-icon-caret-bottom"})],1)]):t._e(),t._v(" "),null!=t.chatInfo?e("div",{staticClass:"chat-header",class:t.isShow?"show":""},[e("div",{staticClass:"chat-avatar"},[e("el-image",{attrs:{src:"/chatAvatar/"+t.chatInfo.pic+".jpg"}})],1),t._v(" "),e("div",{staticClass:"chat-info"},[e("div",{staticClass:"chat-info-name"},[t._v("\n        "+t._s(t.chatInfo.name)),e("span",[t._v("热度"+t._s(t.chatInfo.totalMsg))]),t._v(" "),1==t.chatInfo.status?[e("span",{staticClass:"open"},[t._v("进行中")])]:t._e(),t._v(" "),0==t.chatInfo.status?[e("span",{staticClass:"close"},[t._v("已关闭")])]:t._e()],2),t._v(" "),e("div",{staticClass:"chat-intro",domProps:{innerHTML:t._s(t.chatInfo.intro)}})])]):t._e(),t._v(" "),e("div",{staticClass:"chat-msg"},[null==t.msgList?[t._m(0)]:[e("msg",{ref:"msg",attrs:{msgList:t.msgList}})]],2),t._v(" "),e("div",{staticClass:"chat-input"},[0==t.chatInfo.status?[e("div",{staticClass:"chat-input-close"},[t._v("\n        频道已关闭\n      ")])]:[e("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入消息内容"},model:{value:t.msg,callback:function(e){t.msg=e},expression:"msg"}}),t._v(" "),e("div",{staticClass:"chat-btn"},[e("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-paperclip"},on:{click:function(e){t.linksVisible=!0}}}),t._v(" "),e("el-button",{attrs:{type:"primary",icon:"el-icon-position",size:"small"},on:{click:function(e){return t.sendMsg()}}},[t._v("发送")])],1)]],2),t._v(" "),e("el-dialog",{attrs:{title:"发送链接",visible:t.linksVisible,modal:!1,width:"330px"},on:{"update:visible":function(e){t.linksVisible=e}}},[e("div",{staticClass:"dialog-form"},[e("el-form",{ref:"form",attrs:{"label-position":"top"}},[e("el-form-item",{attrs:{label:"链接名称"}},[e("el-input",{attrs:{type:"text",placeholder:"请输入链接名称"},model:{value:t.linkForm.name,callback:function(e){t.$set(t.linkForm,"name",e)},expression:"linkForm.name"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"链接地址"}},[e("el-input",{attrs:{type:"text",placeholder:"请输入链接地址(http://)"},model:{value:t.linkForm.url,callback:function(e){t.$set(t.linkForm,"url",e)},expression:"linkForm.url"}})],1)],1)],1),t._v(" "),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"success",size:"medium"},on:{click:function(e){return t.sendLink()}}},[t._v("确认发送")])],1)])],1)}),[function(){var t=this._self._c;return t("div",{staticClass:"chat-msg-loading"},[t("div",{staticClass:"chat-msg-loading-main"},[t("i",{staticClass:"el-icon-loading"})])])}],!1,null,null,null);e.default=component.exports;installComponents(component,{Msg:r(712).default})}}]);